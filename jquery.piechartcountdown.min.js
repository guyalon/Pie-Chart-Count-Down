/**
 * Pie Chart Count Down
 * ------------------------------------------
 * Copyright (c) 2012 Victor Jonsson (http://www.victorjonsson.se)
 * Documentation and issue tracking on Github (https://github.com/victorjonsson/Pie-Chart-Count-Down)
 *
 * @credits Tom Ashworth, CSS-animations (https://github.com/phuu)
 * @license Dual licensed under the MIT or GPL Version 2 licenses
 * @requires jQuery version >= 1.6
 * @version 0.1
 * @stable -
 */(function(a){a.fn.pieChartCountDown=function(){var d={size:60,time:10,backgroundColor:"#FFF",color:"#000",callback:null,unSupportedCallback:null,smoothenPieOutline:!0,infinite:!1},e=this;if(arguments.length==1&&typeof arguments[0]=="string"){if(b.isInitiated)if(!b.supportsCSSAnimation||!a.browser.webkit)c.executeCommand(e,arguments[0]);else switch(arguments[0]){case"pause":b.pauseSpinner(e);break;case"resume":b.resumeSpinner(e);break;case"stop":b.removeSpinner(e,e.css("background-color"));break;case"toggle":e.attr("data-spinner-paused")!==undefined?b.resumeSpinner(e):b.pauseSpinner(e);break;default:console.warn("Unkown method "+arguments[0])}return this}for(var f=0;f<arguments.length;f++){var g=arguments[f],h=typeof g;h=="number"||a.isNumeric(g)?d.time=parseInt(g):h=="function"?d.callback=g:g!==null&&g!==!1&&a.extend(d,g)}d.pieceSize=d.size/2,b.isInitiated||b.init(this.get(0));if(!b.supportsCSSAnimation||!a.browser.webkit)typeof d.unSupportedCallback=="function"?d.unSupportedCallback(e):c.start(e,d);else{b.removeSpinner(e,d.backgroundColor);var i=++b.numSpinners,j=b.createMask(d.backgroundColor,"rotate(-45deg)",d.pieceSize,d.time,0,"inner"+i,d.infinite),k=b.createMask(d.color,"rotate(-45deg)",d.pieceSize,d.time,0,"mask",d.infinite),l=b.createMask(d.backgroundColor,"rotate(45deg)",d.pieceSize,d.time,-1,"mask-two",d.infinite);b.generateMaskAnimationKeyframes(d.backgroundColor,i),j.bind(b.animationEndEvent,function(){b.removeSpinner(e,d.backgroundColor),typeof d.callback=="function"&&d.callback(e)});var m={display:"block",background:d.color,width:d.size+"px",height:d.size+"px",position:"relative",visibility:"visible"};m[b.pfx+"mask-box-image"]=b.pfx+"radial-gradient(center,ellipse cover, "+d.color+" 66%, rgba(0,0,0,0) 68%)",m[b.pfx+"mask-attachment"]="scroll",this.html("").append(j).append(k).append(l).attr("data-spinner-id",i).addClass("pie-chart-spinner").css(m).show(),d.smoothenPieOutline&&b.smoothenCircleOutline(this,d.backgroundColor,i),a.rePositionSmootheningCircles(i)}return this},a.rePositionSmootheningCircles=function(b){a("canvas.pie-circle").each(function(){var c=a(this),d=c.attr("data-spinner");if(d!==undefined&&b!=d){var e=a("*[data-spinner-id="+d+"]").eq(0);if(e!==undefined){var f=e.offset();(f.left!=parseInt(c.css("left"))||f.top!=parseInt(c.css("top")))&&c.css({left:f.left+"px",top:f.top+"px"})}}})};var b={numSpinners:0,supportsCSSAnimation:!1,type:null,pfx:null,CSSTransformRule:null,CSSAnimationRule:null,animationEndEvent:null,isInitiated:!1,addAnimationKeyFrames:function(a){},init:function(b){this.isInitiated=!0;var c="Webkit Moz O ms Khtml".split(" ");for(var d=0;d<c.length;d++)if(b.style[c[d]+"AnimationName"]!==undefined){this.supportsCSSAnimation=!0,this.type=c[d].toLowerCase(),this.pfx="-"+this.type+"-",this.CSSTransformRule=this.pfx+"transform",this.CSSAnimationRule=this.pfx+"animation";switch(this.type){case"o":this.animationEndEvent="oAnimationEnd";break;case"webkit":this.animationEndEvent="webkitAnimationEnd";break;default:this.animationEndEvent="animationend"}document.styleSheets&&document.styleSheets.length?this.addAnimationKeyFrames=function(a){document.styleSheets[0].insertRule(a,0)}:this.addAnimationKeyFrames=function(a){var b=document.createElement("style");b.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(b)};break}if(this.supportsCSSAnimation){var e="@"+this.pfx+"keyframes mask {"+"0% {"+this.CSSTransformRule+": rotate(-45deg);}"+"75% {"+this.CSSTransformRule+": rotate(-45deg);}"+"100% {"+this.CSSTransformRule+": rotate(45deg);}"+"}",f="@"+this.pfx+"keyframes mask-two {"+"0% {opacity: 0;}"+"75% {opacity: 0;}"+"76% {opacity: 1;}}";this.addAnimationKeyFrames(e),this.addAnimationKeyFrames(f),a(window).resize(function(){a.rePositionSmootheningCircles()})}},createMask:function(b,c,d,e,f,g,h){var i={display:"block",position:"absolute",top:"1px",left:f+"px",background:"transparent","border-width":d+"px",width:"0",height:"0","border-style":"solid","border-top-color":b,"border-right-color":"transparent","border-left-color":"transparent","border-bottom-color":"transparent"};return i[this.CSSTransformRule]=c,i[this.CSSAnimationRule]=g+" "+e+"s linear "+(h?"infinite":""),a("<div></div>").addClass("spinner-"+g).css(i)},generateMaskAnimationKeyframes:function(a,b){var c="@"+this.pfx+"keyframes inner"+b+" {"+"0% {"+this.CSSTransformRule+":rotate(-45deg);}"+"25% {border-left-color:transparent;}"+"26% {border-left-color:"+a+";}"+"50% {border-bottom-color:transparent;}"+"51% {border-bottom-color:"+a+";}"+"75% {border-right-color:transparent;}"+"76% {border-right-color:"+a+";}"+"100% {"+this.CSSTransformRule+":rotate(315deg); border-left-color:"+a+"; border-bottom-color:"+a+"; border-right-color:"+a+"; }}";this.addAnimationKeyFrames(c)},getResettingCSS:function(a){var c={backgroundColor:a,height:"auto",width:"auto"};return c[b.pfx+"mask-box-image"]="none",c["background-image"]="none",c},smoothenCircleOutline:function(b,c,d){var e=b.outerWidth(),f=a('<canvas width="'+e+'" height="'+e+'"></canvas>');f.attr("id","circle-"+d).addClass("pie-circle").attr("data-spinner",d).appendTo("body");var g=5*Math.round(Math.ceil(e/100)),h=f.get(0).getContext("2d");if(h){var i=e/2,j=e/2,k=e/2-g/2;h.beginPath(),h.arc(i,j,k,0,2*Math.PI,!1),h.fillStyle="transparent",h.fill(),h.lineWidth=g,h.strokeStyle=c,h.stroke();var l=b.offset();f.css({position:"absolute",top:l.top+"px",left:l.left+"px",zIndex:9999})}},removeSmootheningCircle:function(b){a("#circle-"+b).remove()},removeSpinner:function(c,d){var e=c.attr("data-spinner-id");e!==undefined&&(b.removeSmootheningCircle(e),c.children().remove(),c.css(b.getResettingCSS(d)),c.removeAttr("data-spinner-id"),c.removeAttr("data-spinner-paused"),setTimeout(function(){a.rePositionSmootheningCircles()},1))},pauseSpinner:function(a){var b=a.attr("data-spinner-id");if(b!==undefined){a.attr("data-spinner-paused",1);var c={"-ms-animation-play-state":"paused","-o-animation-play-state":"paused","-moz-animation-play-state":"paused","-webkit-animation-play-state":"paused","animation-play-state":" paused"};a.find(".spinner-inner"+b).css(c),a.find(".spinner-mask").css(c),a.find(".spinner-mask-two").css(c)}},resumeSpinner:function(a){var b=a.attr("data-spinner-id");if(b!==undefined){a.removeAttr("data-spinner-paused");var c={"-ms-animation-play-state":"running","-o-animation-play-state":"running","-moz-animation-play-state":"running","-webkit-animation-play-state":"running","animation-play-state":" running"};a.find(".spinner-inner"+b).css(c),a.find(".spinner-mask").css(c),a.find(".spinner-mask-two").css(c)}}},c={id:0,intervals:{},options:{},start:function(a,b){this.remove(a);var c="spinner"+ ++this.id;a.text(b.time).attr("data-interval-id",c).css({fontSize:.8*b.size+"px",background:b.backgroundColor,color:b.color,width:b.size,height:b.size,lineHeight:"normal",textAlign:"center"}),this.options[c]=b;var d=this;this.intervals[c]=setInterval(function(){var b=a.attr("data-spinner-paused");if(b===undefined){var c=parseInt(a.text())-1;c>0?a.text(c):d.remove(a)}},1e3)},executeCommand:function(a,b){switch(b){case"pause":this.pause(a);break;case"resume":this.resume(a);break;case"stop":this.remove(a);break;case"toggle":a.attr("data-spinner-paused")!==undefined?this.resume(a):this.pause(a);break;default:console.warn("Unknown method "+arguments[0])}},remove:function(a){var d=a.attr("data-interval-id");if(d!==undefined){var e=this.options[d];clearInterval(c.intervals[d]),a.text(""),e&&(a.css(b.getResettingCSS(e.backgroundColor)),typeof e.callback=="function"&&e.callback(a)),delete c.intervals[d],delete c.options[d]}},pause:function(a){var b=a.attr("data-interval-id");b!==undefined&&a.attr("data-spinner-paused",1)},resume:function(a){a.removeAttr("data-spinner-paused")}}})(jQuery);